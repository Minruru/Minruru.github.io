<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>第一次去東京就上手｜朝聖MyGO、孤獨搖滾旅遊手冊</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Zen+Maru+Gothic:wght@700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* --- 🎨 全局設計與色彩配置 --- */
        :root {
            --bg-dark: #121212;
            --bg-light: #1E1E1E;
            --card-bg: #2A2A2A;
            --primary-color: #29D8E4; /* 主題色 - 亮青色 */
            --secondary-color: #F7B733; /* 強調色 - 暖黃色 */
            --gemini-grad-start: #8E44AD;
            --gemini-grad-end: #3498DB;
            --text-main: #EAEAEA;
            --text-muted: #A0A0A0;
            --border-color: #444444;
        }

        html { scroll-behavior: smooth; }
        body {
            background-color: var(--bg-dark); color: var(--text-main); font-family: 'Noto Sans TC', sans-serif;
            -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
        }

        /* --- ✒️ 字體排版 --- */
        h1, h2, h3, h4 { font-family: 'Zen Maru Gothic', 'Noto Sans TC', sans-serif; font-weight: 700; }
        h1, h2 { color: var(--primary-color); margin-bottom: 1rem; }
        h3, h4 { color: var(--text-main); margin-bottom: 0.75rem; }
        p { color: var(--text-muted); line-height: 1.7; margin-bottom: 1rem; }
        a { color: var(--secondary-color); text-decoration: none; transition: color 0.3s; }
        a:hover { color: #ffc95e; }

        /* --- 🌟 動畫效果 --- */
        .reveal { opacity: 0; transform: translateY(30px); transition: opacity 0.8s ease-out, transform 0.6s ease-out; }
        .reveal.active { opacity: 1; transform: translateY(0); }

        /* --- 📄 主體與區塊結構 --- */
        .main-content-wrapper { max-width: 1000px; margin: 0 auto; padding: 0 1rem; }
        @media (min-width: 768px) { .main-content-wrapper { padding: 0 2rem; } }
        section { padding: 5rem 0; border-bottom: 1px solid var(--border-color); }
        section:last-of-type { border-bottom: none; }

        /* --- 🚀 封面頁設計 --- */
        #cover-page {
            height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center;
            text-align: center; padding: 1rem;
            background-image: linear-gradient(rgba(18, 18, 18, 0.7), rgba(18, 18, 18, 0.9)), url('https://images.unsplash.com/photo-1542051841857-5f90071e7989?q=80&w=2070&auto=format&fit=crop');
            background-size: cover; background-position: center; border-bottom: 1px solid var(--border-color);
        }
        #cover-page h1 { font-size: 3rem; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }
        #cover-page p { font-size: 1.25rem; font-weight: 300; }
        @media (min-width: 768px) { #cover-page h1 { font-size: 4.5rem; } #cover-page p { font-size: 1.5rem; } }
        #cover-page .explore-btn {
            margin-top: 2rem; padding: 0.8rem 2rem; background-color: var(--primary-color); color: var(--bg-dark);
            border-radius: 50px; font-size: 1rem; font-weight: 700; box-shadow: 0 4px 20px rgba(41, 216, 228, 0.3);
            transition: all 0.3s ease; border: none; cursor: pointer;
        }
        #cover-page .explore-btn:hover { transform: translateY(-5px); box-shadow: 0 8px 30px rgba(41, 216, 228, 0.4); }

        /* --- 🧭 導覽列 --- */
        header.sticky-header {
            position: sticky; top: 0; z-index: 1000; background-color: rgba(18, 18, 18, 0.85);
            backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border-bottom: 1px solid var(--border-color);
        }
        header nav {
            max-width: 1200px; margin: 0 auto; padding: 0.75rem 1rem; display: flex;
            justify-content: space-between; align-items: center;
        }
        header .nav-title { font-size: 1.25rem; font-weight: 700; color: var(--primary-color); }
        header .nav-links a {
            color: var(--text-muted); text-decoration: none; margin: 0 0.5rem; padding: 0.5rem 0;
            position: relative; transition: color 0.3s ease; font-size: 0.9rem;
        }
        @media (min-width: 1200px) { header .nav-links a { margin: 0 0.75rem; font-size: 1rem;} }
        header .nav-links a::after {
            content: ''; position: absolute; bottom: 0; left: 0; width: 0; height: 2px;
            background-color: var(--primary-color); transition: width 0.3s ease;
        }
        header .nav-links a:hover, header .nav-links a.active { color: var(--text-main); }
        header .nav-links a:hover::after, header .nav-links a.active::after { width: 100%; }
        .mobile-nav-container { display: none; }
        .print-btn {
            background: none; border: 1px solid var(--border-color); color: var(--text-muted);
            padding: 0.5rem 1rem; border-radius: 20px; cursor: pointer; transition: all 0.3s ease; margin-left: 1rem;
        }
        .print-btn:hover { background-color: var(--primary-color); color: var(--bg-dark); border-color: var(--primary-color); }
        @media (max-width: 1024px) {
            header .nav-links { display: none; }
            .mobile-nav-container { display: block; }
            #mobile-nav {
                background-color: var(--card-bg); color: var(--text-main); border: 1px solid var(--border-color);
                border-radius: 8px; padding: 0.5rem;
            }
        }

        /* --- 🃏 卡片與元件設計 --- */
        .card {
            background-color: var(--card-bg); border-radius: 12px; padding: 1.5rem;
            border: 1px solid var(--border-color); transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        @media (min-width: 768px) { .card { padding: 2rem; } }
        .section-header { text-align: center; margin-bottom: 3rem; }
        .section-header h2 { font-size: 2.25rem; }
        .section-header p { font-size: 1.1rem; color: var(--text-muted); max-width: 600px; margin: 0 auto; }
        .grid { display: grid; gap: 2rem; }
        .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        @media (min-width: 768px) { .md-grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); } }
        @media (min-width: 1024px) { .lg-grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); } }
        .mb-12 { margin-bottom: 3rem; }
        .stat-card { display: flex; flex-direction: column; align-items: center; text-align: center; }
        .stat-card-icon {
            background-color: var(--bg-light); border-radius: 50%; width: 60px; height: 60px;
            display: flex; justify-content: center; align-items: center; margin-bottom: 1rem; color: var(--primary-color);
        }
        .stat-card-icon svg { width: 2rem; height: 2rem; }
        .stat-card span:nth-of-type(1) { color: var(--text-muted); }
        .stat-card span:nth-of-type(2) { font-size: 1.8rem; font-weight: 700; margin-top: 0.25rem; }

        /* --- 🖼️ 圖片與燈箱 --- */
        .section-image, .attraction-detail-image {
            width: 100%; object-fit: cover; border-radius: 12px;
            margin-bottom: 2rem; cursor: pointer; transition: all 0.3s ease;
        }
        .section-image { height: 250px; }
        .attraction-detail-image { height: 200px; }
        .section-image:hover, .attraction-detail-image:hover { filter: brightness(1.2); transform: scale(1.02); }
        #lightbox {
            position: fixed; z-index: 10000; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.9); display: none; justify-content: center; align-items: center;
        }
        #lightbox.active { display: flex; animation: fadeIn 0.3s; }
        #lightbox img { max-width: 90vw; max-height: 85vh; object-fit: contain; }
        #lightbox .close {
            position: absolute; top: 20px; right: 30px; color: #fff; font-size: 40px;
            font-weight: bold; transition: 0.3s; cursor: pointer;
        }

        /* --- 🗂️ 頁籤/分頁系統 --- */
        .tabs { display: flex; flex-wrap: wrap; justify-content: center; gap: 0.5rem; margin-bottom: 2rem; }
        .tab-btn, .category-tab-btn, .attraction-tab-btn, .transportation-tab-btn {
            background-color: var(--card-bg); border: 1px solid var(--border-color); color: var(--text-muted);
            padding: 0.6rem 1.2rem; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; font-weight: 500;
        }
        .attraction-tab-btn, .transportation-tab-btn { font-size: 0.8rem; padding: 0.5rem 1rem; border-radius: 20px; }
        .tab-btn:hover, .category-tab-btn:hover, .attraction-tab-btn:hover, .transportation-tab-btn:hover {
            background-color: var(--primary-color); color: var(--bg-dark); border-color: var(--primary-color); transform: translateY(-2px);
        }
        .tab-btn.active, .category-tab-btn.active, .attraction-tab-btn.active, .transportation-tab-btn.active {
            background-color: var(--primary-color); color: var(--bg-dark); border-color: var(--primary-color);
            box-shadow: 0 4px 15px rgba(41, 216, 228, 0.2); font-weight: 700;
        }
        .tab-content, .category-tab-content, .attraction-content, .transportation-content { animation: fadeIn 0.5s; }
        .hidden { display: none; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- ✅ 清單樣式 --- */
        .prose-custom ul { list-style-type: none; padding-left: 0; }
        .prose-custom li { position: relative; padding-left: 2em; margin-bottom: 1rem; }
        .prose-custom li::before {
            position: absolute; left: 0; top: 0.1em; font-size: 1.2em; color: var(--primary-color);
        }
        #itinerary .prose-custom li::before { content: '➡️'; }
        #attractions .prose-custom li::before { content: '✨'; }
        #transportation .prose-custom li::before { content: '🚌'; }
        .interactive-checklist ul { padding-left: 0; list-style: none; }
        .interactive-checklist li { padding-left: 2.5rem; position: relative; margin-bottom: 1rem; }
        .interactive-checklist input[type="checkbox"] { position: absolute; opacity: 0; cursor: pointer; }
        .interactive-checklist label { cursor: pointer; display: block; }
        .interactive-checklist label::before {
            content: ''; position: absolute; left: 0; top: 50%; transform: translateY(-50%);
            width: 24px; height: 24px; border: 2px solid var(--border-color);
            border-radius: 6px; background-color: var(--bg-light); transition: all 0.2s ease;
        }
        .interactive-checklist input:checked + label::before { background-color: var(--secondary-color); border-color: var(--secondary-color); }
        .interactive-checklist input:checked + label { color: var(--text-muted); text-decoration: line-through; }
        .interactive-checklist label::after {
            content: '✔'; position: absolute; left: 6px; top: 50%; transform: translateY(-50%) scale(0);
            font-size: 16px; color: var(--bg-dark); transition: transform 0.2s ease;
        }
        .interactive-checklist input:checked + label::after { transform: translateY(-50%) scale(1); }

        /* --- 📈 圖表與表格 --- */
        .chart-container { position: relative; height: 350px; width: 100%; }
        .chart-container.h-96 { height: 24rem; }
        table { width: 100%; border-collapse: collapse; color: var(--text-muted); }
        th, td { padding: 0.75rem 1rem; text-align: left; }
        thead { border-bottom: 2px solid var(--primary-color); color: var(--text-main); }
        tbody tr { border-bottom: 1px solid var(--border-color); }
        tbody tr:last-child { border-bottom: none; }
        tbody tr:hover { background-color: var(--bg-light); }
        tbody tr .font-medium { color: var(--text-main); }
        table tfoot { font-weight: bold; color: var(--primary-color); font-size: 1.1rem; }
        .text-right { text-align: right; }

        /* --- ✨ Gemini AI 功能 --- */
        .gemini-btn {
            background-image: linear-gradient(45deg, var(--gemini-grad-start), var(--gemini-grad-end));
            color: white; border: none; padding: 0.6rem 1.2rem; border-radius: 20px;
            cursor: pointer; font-weight: 500; display: inline-flex; align-items: center; gap: 0.5rem;
            transition: all 0.3s ease; margin-top: 1rem;
        }
        .gemini-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(142, 68, 173, 0.3); }
        
        #gemini-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10001;
            background-color: rgba(0,0,0,0.7); display: flex; justify-content: center;
            align-items: center; opacity: 0; visibility: hidden; transition: all 0.3s ease;
        }
        #gemini-modal.active { opacity: 1; visibility: visible; }
        .gemini-modal-content {
            background-color: var(--card-bg); border-radius: 12px; padding: 2rem;
            width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto;
            border: 1px solid var(--border-color);
            position: relative;
            transform: scale(0.9); transition: transform 0.3s ease;
        }
        #gemini-modal.active .gemini-modal-content { transform: scale(1); }
        .gemini-modal-close {
            position: absolute; top: 1rem; right: 1rem; background: none; border: none;
            color: var(--text-muted); font-size: 1.5rem; cursor: pointer;
        }
        #gemini-modal-title { color: var(--primary-color); margin-bottom: 1rem; }
        #gemini-modal-body { color: var(--text-main); line-height: 1.8; white-space: pre-wrap; }
        #gemini-modal-body ul { list-style-position: inside; padding-left: 1rem;}
        #gemini-modal-body li { margin-bottom: 0.5rem; }

        .loader {
            width: 48px; height: 48px; border: 5px solid var(--primary-color);
            border-bottom-color: transparent; border-radius: 50%; display: inline-block;
            box-sizing: border-box; animation: rotation 1s linear infinite; margin: 2rem auto; display: block;
        }
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* --- 🖨️ 列印樣式 --- */
        @media print {
            body { background-color: #fff; color: #000; font-size: 10pt; }
            header, footer, #cover-page, .print-btn, .tabs, .section-image, #lightbox, .gemini-btn, #gemini-modal { display: none !important; }
            .main-content-wrapper, section { padding: 0; border: none; margin-top: 1.5rem; }
            .card { box-shadow: none; border: 1px solid #ccc; padding: 1rem; page-break-inside: avoid; }
            a { text-decoration: none; color: #000; }
            a[href^="http"]::after { content: " (" attr(href) ")"; color: #555; }
            h1, h2, h3, h4 { color: #000; page-break-after: avoid; }
            .reveal { opacity: 1; transform: translateY(0); }
            .chart-container, .grid { page-break-inside: avoid; }
            .tab-content, .category-tab-content, .attraction-content, .transportation-content, .hidden {
                display: block !important; border-top: 1px solid #eee; padding-top: 1rem; margin-top: 1rem;
            }
        }
    </style>
</head>
<body>

    <div id="cover-page">
        <h1 class="reveal">第一次去東京就上手</h1>
        <p class="reveal">您的專屬動漫聖地與美食探險之旅</p>
        <button onclick="document.getElementById('overview').scrollIntoView();" class="explore-btn reveal">
            開始探索
        </button>
    </div>

    <header class="sticky-header">
        <nav>
            <div class="nav-title">東京動漫聖地巡禮</div>
            <div class="nav-links">
                <a href="#overview" class="nav-link active">總覽</a>
                <a href="#itinerary" class="nav-link">每日行程</a>
                <a href="#attractions" class="nav-link">景點美食介紹</a>
                <a href="#transportation" class="nav-link">交通資訊</a>
                <a href="#budget" class="nav-link">預算分析</a>
                <a href="#shopping-list" class="nav-link">購物&伴手禮清單</a>
                <a href="#checklist" class="nav-link">行前準備</a>
            </div>
            <div class="flex items-center">
                <div class="mobile-nav-container">
                    <select id="mobile-nav" onchange="document.querySelector(this.value).scrollIntoView();">
                        <option value="#overview">總覽</option>
                        <option value="#itinerary">每日行程</option>
                        <option value="#attractions">景點美食介紹</option>
                        <option value="#transportation">交通資訊</option>
                        <option value="#budget">預算分析</option>
                        <option value="#shopping-list">購物&伴手禮清單</option>
                        <option value="#checklist">行前準備</option>
                    </select>
                </div>
                <button class="print-btn" onclick="window.print()">🖨️ 列印</button>
            </div>
        </nav>
    </header>

    <main class="main-content-wrapper">

        <section id="overview">
            <div class="section-header reveal">
                <h2>行程總覽</h2>
                <p>一目了然您的東京之旅核心資訊：費用、時間與目的地。</p>
            </div>
            <img src="https://images.unsplash.com/photo-1513407030348-c983a97b98d8?q=80&w=1200&auto=format&fit=crop" alt="Tokyo Overview Image" class="section-image reveal lightbox-trigger">
            <div class="grid grid-cols-1 md-grid-cols-3 mb-12">
                <div class="card stat-card reveal" style="transition-delay: 0.1s;">
                    <div class="stat-card-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 10v-1m0-13a9 9 0 110 18 9 9 0 010-18z"></path></svg></div>
                    <span>預估總費用</span>
                    <span id="totalCost"></span>
                </div>
                <div class="card stat-card reveal" style="transition-delay: 0.2s;">
                    <div class="stat-card-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg></div>
                    <span>旅行期間</span>
                    <span>6天5夜</span>
                </div>
                 <div class="card stat-card reveal" style="transition-delay: 0.3s;">
                    <div class="stat-card-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg></div>
                    <span>核心目的地</span>
                    <span style="font-size: 1.5rem;">下北澤/澀谷/秋葉原</span>
                </div>
            </div>
            <div class="card reveal">
                <h3 class="text-center">預算費用分佈</h3>
                <div class="chart-container">
                    <canvas id="budgetDonutChart"></canvas>
                </div>
            </div>
        </section>

        <section id="itinerary">
            <div class="section-header reveal">
                <h2>每日行程規劃</h2>
                <p>點擊下方日期，探索每一天的詳細活動與動漫聖地巡禮！</p>
            </div>
            <img src="https://images.unsplash.com/photo-1539382430256-11b025a7d0d1?q=80&w=1200&auto=format&fit=crop" alt="Daily Itinerary Image" class="section-image reveal lightbox-trigger">
            <div class="tabs reveal">
                <button data-tab="day1" class="tab-btn active">Day 1 (8/18 一)</button>
                <button data-tab="day2" class="tab-btn">Day 2 (8/19 二)</button>
                <button data-tab="day3" class="tab-btn">Day 3 (8/20 三)</button>
                <button data-tab="day4" class="tab-btn">Day 4 (8/21 四)</button>
                <button data-tab="day5" class="tab-btn">Day 5 (8/22 五)</button>
                <button data-tab="day6" class="tab-btn">Day 6 (8/23 六)</button>
            </div>
            <div class="card reveal">
                <div class="prose-custom">
                    <div id="day1" class="tab-content">
                        <h3>Day 1 (8/18 一): 抵達與下北澤探索</h3>
                        <p>抵達東京成田機場(NRT)後，搭乘 N'EX 至澀谷，再轉乘京王井之頭線抵達充滿文青與復古風情的下北澤。入住飯店後，準備開始您的《孤獨搖滾！》聖地巡禮！</p>
                        <ul>
                            <li>🛌 08:00-09:30 起床梳洗，準備行李</li>
                            <li>✈️ 09:30-11:30 抵達桃園國際機場</li>
                            <li>📝 11:30-12:30 準備登機手續並過關</li>
                            <li>🍔 12:30-14:15 過關後在機場進食</li>
                            <li>🛫 14:15-18:35 桃園國際機場到東京成田機場</li>
                            <li>🏨 18:35-20:30 抵達下北澤芥末飯店</li>
                            <li>🛒 20:30-21:30 飯店附近的超商解決晚餐</li>
                            <li>🛀 21:30-23:00 洗澡休息</li>
                            <li>😴 23:00-07:00 睡覺</li>
                        </ul>
                        <button class="gemini-btn itinerary-ai-btn">✨ AI 幫我看看</button>
                    </div>
                    <div id="day2" class="tab-content hidden">
                        <h3>Day 2 (8/19 二): 下北澤探索</h3>
                        <p>今日將深度探索下北澤，進行《孤獨搖滾！》聖地巡禮，並品嚐當地特色美食。</p>
                        <ul>
                            <li>🛌 07:00-08:00 起床梳洗</li>
                            <li>☕ 08:00-09:00 附近超商吃早餐</li>
                            <li>🎸 09:00-12:00 前往孤獨搖滾聖地Shelter Live House (STARRY原型)、🅿️ Times 下北澤第八停車場 (團體照拍攝地)</li>
                            <li>🍛 12:00-13:30 午餐 路地裏咖哩 侍 下北澤店 用餐</li>
                            <li>🛍️ 13:30-15:30 探索下北澤一番街的獨特店鋪與古著店</li>
                            <li>🍮 16:00-17:00 白髭泡芙工房 吃龍貓泡芙</li>
                            <li>🚶 17:00-18:00 在下北澤街道繼續閒逛</li>
                            <li>🍔 18:00-19:00 Village Vanguard Diner Shimokitazawa 用餐</li>
                            <li>🌃 19:00-20:00 到下北澤夜市逛逛，看有沒有便宜衣服</li>
                            <li>🚿 20:00-22:00 回到飯店洗澡休息</li>
                            <li>✅ 22:00-23:00 確認隔日行程並準備睡覺</li>
                            <li>😴 23:00-07:00 睡覺</li>
                        </ul>
                        <button class="gemini-btn itinerary-ai-btn">✨ AI 幫我看看</button>
                    </div>
                    <div id="day3" class="tab-content hidden">
                        <h3>Day 3 (8/20 三): 澀谷、新宿一日遊 & 前進秋葉原</h3>
                        <p>前往新宿、澀谷逛逛吃美食，傍晚，搭乘JR線前往動漫與電子的聖地——秋葉原，並入住新飯店。</p>
                        <ul>
                            <li>🛌 07:00-08:00 起床梳洗</li>
                            <li>🏨 08:00-08:30 準備退房離開飯店</li>
                            <li>☕ 08:30-10:00 えくぶり 用餐</li>
                            <li>🚆 10:00-10:20 從下北澤搭車到涉谷站</li>
                            <li>🛍️ 10:20-12:00 逛ユニクロ 渋谷道玄坂店、涉谷GU採買衣服（也要幫老媽買）</li>
                            <li>🚶 12:00-12:10 抵達午餐地點</li>
                            <li>🍖 12:10-13:40 吟味焼肉 じゃんか 道玄坂 用餐</li>
                            <li>🚗 13:40-14:20 搭車前往Tokyo Bitcoin Base</li>
                            <li>⛩️ 14:20-16:00 逛Tokyo Bitcoin Base</li>
                            <li>🚆 16:00-16:50 搭車前往人形町今半 新宿髙島屋店（務必17:00前抵達）</li>
                            <li>🍲 17:00-18:30 在人形町今半 新宿髙島屋店 用餐</li>
                            <li>🧳 18:30-19:30 搭車前往東京中央大飯店 Check In</li>
                            <li>🏪 19:30-20:30 逛一下飯店周邊與超商購買零食與明天早餐</li>
                            <li>🛀 20:30-22:00 回到飯店洗澡休息</li>
                            <li>✅ 22:00-23:00 確認明天行程</li>
                            <li>😴 23:00-07:00 睡覺</li>
                        </ul>
                        <button class="gemini-btn itinerary-ai-btn">✨ AI 幫我看看</button>
                    </div>
                    <div id="day4" class="tab-content hidden">
                        <h3>Day 4 (8/21 四): 《MyGO!!!!!》聖地巡禮日</h3>
                        <p>今日是《MyGO!!!!!》的聖地巡禮日！前往飛鳥山公園、舊古河庭園，朝聖爽世與祥子戰鬥過，以及祥子成為人類的橋。</p>
                        <ul>
                            <li>🛌 07:00-08:00 起床梳洗</li>
                            <li>☕ 08:00-09:30 吃昨天準備的早餐</li>
                            <li>🌳 09:30-10:00 搭車前往飛鳥山公園</li>
                            <li>🚶‍♀️ 10:00-11:00 朝聖爽世與祥子戰鬥過的地方，可搭鐵軌逛公園</li>
                            <li>🏡 11:00-11:20 走路前往舊古河庭園</li>
                            <li>🌸 11:20-12:20 在舊古河庭園朝聖祥子的家</li>
                            <li>🚶 12:00-12:10 到旁邊的ココフル</li>
                            <li>🍔 12:10-13:40 在ココフル 用餐</li>
                            <li>🚗 13:40-14:30 搭車前往千登世步道橋，朝聖成為人類橋</li>
                            <li>🤝 14:30-15:30 在千登世步道橋周圍逛逛</li>
                            <li>🚆 15:30-16:10 搭車回到東京中央大飯店</li>
                            <li>😴 16:10-17:10 在飯店休息</li>
                            <li>🚶‍♀️ 17:10-17:30 走路到廚房南海 神保町店</li>
                            <li>🍽️ 17:30-19:00 在 廚房南海 神保町店 用餐</li>
                            <li>19:00-20:00 買好明天早餐並回到飯店</li>
                            <li>🚿 20:00-22:00 回到飯店洗澡休息</li>
                            <li>✅ 22:00-23:00 確認明天行程</li>
                            <li>😴 23:00-07:00 睡覺</li>
                        </ul>
                        <button class="gemini-btn itinerary-ai-btn">✨ AI 幫我看看</button>
                    </div>
                    <div id="day5" class="tab-content hidden">
                        <h3>Day 5 (8/22 五): 秋葉原動漫之旅</h3>
                        <p>今日將深度探索秋葉原的動漫文化，從電器、模型到各式周邊商品，讓您滿載而歸！</p>
                        <ul>
                            <li>🛌 07:00-08:00 起床梳洗</li>
                            <li>☕ 08:00-10:00 吃飯店的早餐或者附近超商</li>
                            <li>📺 10:00-12:00 前往秋葉原ラジオ會館</li>
                            <li>🚶 12:00-12:30 前往とんこつラーメン博多風龍 秋葉原総本店</li>
                            <li>🍛 12:00-14:00 在とんこつラーメン博多風龍 秋葉原総本店 用餐</li>
                            <li>🎮 14:00-17:00 繼續逛秋葉原ラジオ會館、e-earphone 秋葉原店等店面</li>
                            <li>🛍️ 17:00-18:00 前往SEEKBASE、2k540手工藝品店逛逛</li>
                            <li>🍜 18:00-19:10 前往とんかつ檍のカレー屋 いっぺこっぺ 秋葉原店 用餐</li>
                            <li>🛒 19:10-20:30 先買明天早餐並回到飯店</li>
                            <li>🚿 20:30-22:00 回到飯店洗澡休息</li>
                            <li>✅ 22:00-23:00 確認明天行程與退房時間</li>
                            <li>😴 23:00-08:00 睡覺</li>
                        </ul>
                        <button class="gemini-btn itinerary-ai-btn">✨ AI 幫我看看</button>
                    </div>
                    <div id="day6" class="tab-content hidden">
                        <h3>Day 6 (8/23 六): 伴手禮採買日&啟程返家</h3>
                        <p>整理行囊，享受在東京的最後一天。從秋葉原地區購買伴手禮，中午隨意吃喝，下午搭車到成田機場，準備搭晚上的班機平安返家。</p>
                        <ul>
                            <li>🛌 08:00-09:00 起床梳洗吃早餐</li>
                            <li>🏨 09:00-10:00 準備行李與確認重要物品並退房</li>
                            <li>10:00-10:30 前往秋葉原ラジオ會館</li>
                            <li>10:30-12:30 在會館一樓的ギフトショップ The AkiBa 購買伴手禮</li>
                            <li>12:30-14:30 隨便找一間店用餐</li>
                            <li>14:30-15:30 在附近的全家購買蘋果乾兩包（子儀伴手禮）</li>
                            <li>15:30-17:00 搭車前往成田機場</li>
                            <li>17:00-19:00在機場準備登機手續與用餐</li>
                            <li>19:00-19:30 搭接駁車到登機處</li>
                            <li>19:30-22:35 揮手告別東京，搭機返回台灣</li>
                            <li>22:35-23:35 搭計程車前往肥肥的大叔叔家</li>
                        </ul>
                        <button class="gemini-btn itinerary-ai-btn">✨ AI 幫我看看</button>
                    </div>
                </div>
            </div>
        </section>

        <section id="attractions">
            <div class="section-header reveal">
                <h2>景點、美食介紹</h2>
                <p>深入了解行程中各個地點的特色與推薦資訊。</p>
            </div>
            <img src="https://images.unsplash.com/photo-1549767579-990e1f435a22?q=80&w=1200&auto=format&fit=crop" alt="Attractions and Food Image" class="section-image reveal lightbox-trigger">
            <div class="tabs reveal">
                <button data-category-tab="category-shimokita" class="category-tab-btn active">下北澤區域</button>
                <button data-category-tab="category-shibuya-shinjuku" class="category-tab-btn">澀谷/新宿區域</button>
                <button data-category-tab="category-mygo-area" class="category-tab-btn">MyGO!!!!!聖地</button>
                <button data-category-tab="category-akiba" class="category-tab-btn">秋葉原/神保町</button>
            </div>
            <div class="card reveal">
                <div class="prose-custom">
                    <!-- Shimokitazawa Category -->
                    <div id="category-shimokita" class="category-tab-content">
                        <div class="tabs">
                            <button data-attraction-tab="hotel-mustard" class="attraction-tab-btn active">下北澤芥末飯店</button>
                            <button data-attraction-tab="shelter-live-house" class="attraction-tab-btn">Shelter Live House</button>
                            <button data-attraction-tab="times-parking" class="attraction-tab-btn">Times停車場</button>
                            <button data-attraction-tab="curry-samurai" class="attraction-tab-btn">路地裏咖哩 侍</button>
                            <button data-attraction-tab="shirahige-choux" class="attraction-tab-btn">白髭泡芙工房</button>
                            <button data-attraction-tab="village-vanguard-diner" class="attraction-tab-btn">Village Vanguard Diner</button>
                            <button data-attraction-tab="ekuburi" class="attraction-tab-btn">えくぶり</button>
                        </div>
                        <div id="hotel-mustard" class="attraction-content">
                            <img src="https://images.unsplash.com/photo-1566073771259-6a8506099945?q=80&w=1200&auto=format&fit=crop" alt="下北澤芥末飯店" class="attraction-detail-image lightbox-trigger">
                            <h4>下北澤芥末飯店 (MUSTARD HOTEL SHIMOKITAZAWA) 🏨</h4>
                            <p>位於下北澤心臟地帶的設計旅店，以其簡約時尚的風格和便利的地理位置著稱，是體驗下北澤文創氛圍的絕佳起點。</p>
                        </div>
                        <div id="shelter-live-house" class="attraction-content hidden">
                             <img src="https://images.unsplash.com/photo-1524368535928-5b5e00ddc76b?q=80&w=1200&auto=format&fit=crop" alt="Shelter Live House" class="attraction-detail-image lightbox-trigger">
                             <h4>Shelter Live House (STARRY原型) 🎤</h4>
                             <p>東京歷史悠久的知名 Live House，也是《孤獨搖滾！》中「STARRY」Live House 的原型。</p>
                        </div>
                        <div id="times-parking" class="attraction-content hidden">
                             <img src="https://images.unsplash.com/photo-1616362355033-116416204155?q=80&w=1200&auto=format&fit=crop" alt="Times停車場" class="attraction-detail-image lightbox-trigger">
                             <h4>Times 下北澤第八停車場 (團體照拍攝地) 🅿️</h4>
                             <p>因《孤獨搖滾！》動畫中「團結Band」在此拍攝經典團體照而聞名，成為粉絲們爭相模仿拍照的聖地。</p>
                        </div>
                        <div id="curry-samurai" class="attraction-content hidden">
                             <img src="https://images.unsplash.com/photo-1582243544237-2ea11e5a5944?q=80&w=1200&auto=format&fit=crop" alt="路地裏咖哩 侍" class="attraction-detail-image lightbox-trigger">
                             <h4>路地裏咖哩 侍 下北澤店 🍛</h4>
                             <p>下北澤地區知名的湯咖哩專賣店，以其豐富的蔬菜、濃郁的湯頭和多樣的客製化選擇受到歡迎。</p>
                             <ul>
                                <li>推薦料理：招牌湯咖哩，可選擇辣度、湯頭種類和多種配料（如雞腿、豬肉、海鮮或各式蔬菜）。</li>
                                <li>每人平均用餐價位：￥1,320 - ￥2,255</li>
                                <li>支付方式：不接受信用卡付款、不接受電子現金、接受PayPay支付（QRCode）</li>
                                <li>參考資料：<a href="https://tabelog.com/tw/tokyo/A1318/A131802/13165636/dtlmenu/" target="_blank">日本餐廳評論網站</a></li>
                             </ul>
                             <button class="gemini-btn food-ai-btn" data-restaurant="路地裏咖哩 侍 下北澤店">✨ AI 美食顧問</button>
                        </div>
                        <div id="shirahige-choux" class="attraction-content hidden">
                              <img src="https://images.unsplash.com/photo-1620289299713-b5443a479493?q=80&w=1200&auto=format&fit=crop" alt="白髭泡芙工房" class="attraction-detail-image lightbox-trigger">
                             <h4>白髭泡芙工房 🍮</h4>
                             <p>宮崎駿動畫迷必訪的可愛咖啡廳！這裡提供獨特的龍貓造型泡芙，造型可愛，內餡口味多樣。</p>
                             <ul>
                                <li>推薦料理：龍貓造型泡芙 (口味有卡士達、巧克力、季節限定等)。</li>
                                <li>每人平均用餐價位：￥999</li>
                                <li>支付方式：不接受信用卡付款、不接受電子現金、接受PayPay支付（QRCode）</li>
                                <li>參考資料：<a href="https://tabelog.com/tw/tokyo/A1318/A131812/13161008/" target="_blank">日本餐廳評論網站</a></li>
                             </ul>
                             <button class="gemini-btn food-ai-btn" data-restaurant="白髭泡芙工房">✨ AI 美食顧問</button>
                        </div>
                        <div id="village-vanguard-diner" class="attraction-content hidden">
                             <img src="https://images.unsplash.com/photo-1561758033-d89a9ad46330?q=80&w=1200&auto=format&fit=crop" alt="Village Vanguard Diner" class="attraction-detail-image lightbox-trigger">
                             <h4>Village Vanguard Diner Shimokitazawa 🍔</h4>
                             <p>由知名雜貨店經營的漢堡店，以其「大人漢堡」為特色，嚴選食材，提供美味且令人愉悅的正宗漢堡體驗。</p>
                             <ul>
                                <li>推薦料理：多汁的牛肉餅漢堡，如鳳梨燒烤漢堡、辣椒起司漢堡等。</li>
                                <li>每人平均用餐價位：午餐約 ¥1,000 - ¥1,999；晚餐約 ¥2,000 - ¥2,999。</li>
                                <li>支付方式：接受信用卡付款、電子現金（部分電子錢包）、PayPay支付（QRCode）</li>
                                <li>參考資料：<a href="https://tabelog.com/tw/tokyo/A1318/A131802/13022465/" target="_blank">日本餐廳評論網站</a></li>
                             </ul>
                             <button class="gemini-btn food-ai-btn" data-restaurant="Village Vanguard Diner Shimokitazawa">✨ AI 美食顧問</button>
                        </div>
                         <div id="ekuburi" class="attraction-content hidden">
                             <img src="https://images.unsplash.com/photo-1525351484163-7529414344d8?q=80&w=1200&auto=format&fit=crop" alt="えくぶり" class="attraction-detail-image lightbox-trigger">
                             <h4>えくぶり ☕</h4>
                             <p>這是一家提供舒適早餐體驗的咖啡店，適合在行程開始前享用一份悠閒的早點。</p>
                             <ul>
                                 <li>推薦料理：日式早餐套餐、各式吐司、咖啡等。</li>
                                 <li>參考資料：<a href="https://tabelog.com/tokyo/A1318/A131802/13243840/" target="_blank">Tabelog 連結</a></li>
                             </ul>
                             <button class="gemini-btn food-ai-btn" data-restaurant="下北澤早餐店 えくぶり">✨ AI 美食顧問</button>
                        </div>
                    </div>
                    <!-- Shibuya/Shinjuku Category -->
                    <div id="category-shibuya-shinjuku" class="category-tab-content hidden">
                        <div class="tabs">
                            <button data-attraction-tab="uniqlo-shibuya" class="attraction-tab-btn active">ユニクロ 渋谷道玄坂店</button>
                            <button data-attraction-tab="gu-shibuya" class="attraction-tab-btn">GU 渋谷店</button>
                            <button data-attraction-tab="janka-dogenzaka" class="attraction-tab-btn">吟味焼肉 じゃんか 道玄坂</button>
                            <button data-attraction-tab="tokyo-bitcoin-base" class="attraction-tab-btn">Tokyo Bitcoin Base</button>
                             <button data-attraction-tab="imahan-takashimaya" class="attraction-tab-btn">人形町今半 新宿髙島屋店</button>
                        </div>
                         <div id="uniqlo-shibuya" class="attraction-content">
                             <img src="https://images.unsplash.com/photo-1593014343464-954a1a8cda48?q=80&w=1200&auto=format&fit=crop" alt="ユニクロ 渋谷道玄坂店" class="attraction-detail-image lightbox-trigger">
                             <h4>ユニクロ 渋谷道玄坂店 👕</h4>
                             <p>位於澀谷的 Uniqlo 分店，提供最新款式的服飾，是採購基本款與潮流單品的好去處。</p>
                        </div>
                        <div id="gu-shibuya" class="attraction-content hidden">
                             <img src="https://images.unsplash.com/photo-1551488831-00ddcb6c6bd3?q=80&w=1200&auto=format&fit=crop" alt="GU 渋谷店" class="attraction-detail-image lightbox-trigger">
                             <h4>GU 渋谷店 👖</h4>
                             <p>Uniqlo 的姊妹品牌，以更親民的價格提供時尚潮流服飾，深受年輕人喜愛。</p>
                        </div>
                        <div id="janka-dogenzaka" class="attraction-content hidden">
                             <img src="https://images.unsplash.com/photo-1553621042-f6e147245754?q=80&w=1200&auto=format&fit=crop" alt="吟味焼肉 じゃんか 道玄坂" class="attraction-detail-image lightbox-trigger">
                             <h4>吟味焼肉 じゃんか 道玄坂 🍖</h4>
                             <p>澀谷知名的燒肉店，以提供高品質的肉品（特別是和牛）聞名，讓您能品嚐到入口即化的美味燒肉。</p>
                              <ul>
                                <li>推薦料理：各部位的和牛燒肉、特選拼盤。</li>
                                <li>每人平均用餐價位：￥1,000－￥1,999</li>
                                <li>支付方式：可接受信用卡、不接受電子現金（西瓜卡等）、接受PayPay支付（QRCode）</li>
                                <li>參考資料：<a href="https://tabelog.com/tokyo/A1303/A130301/13007287/" target="_blank">日本餐廳評論網站</a></li>
                             </ul>
                             <button class="gemini-btn food-ai-btn" data-restaurant="吟味焼肉 じゃんか 道玄坂">✨ AI 美食顧問</button>
                        </div>
                        <div id="tokyo-bitcoin-base" class="attraction-content hidden">
                             <img src="https://images.unsplash.com/photo-1642150348821-420958a74a27?q=80&w=1200&auto=format&fit=crop" alt="Tokyo Bitcoin Base" class="attraction-detail-image lightbox-trigger">
                             <h4>Tokyo Bitcoin Base 🪙</h4>
                             <p>一個與加密貨幣、區塊鏈相關的實體空間或社群據點，吸引著對區塊鏈技術和文化感興趣的人士。</p>
                        </div>
                        <div id="imahan-takashimaya" class="attraction-content hidden">
                             <img src="https://images.unsplash.com/photo-1623405786356-8564a6f9479a?q=80&w=1200&auto=format&fit=crop" alt="人形町今半 新宿髙島屋店" class="attraction-detail-image lightbox-trigger">
                             <h4>人形町今半 新宿髙島屋店 🍲</h4>
                             <p>日本頂級的壽喜燒和涮涮鍋專門店，以嚴選和牛和傳統烹飪方式聞名，提供精緻且道地的日式用餐體驗。</p>
                             <ul>
                                <li>推薦料理：壽喜燒、涮涮鍋（和牛品質極高）。</li>
                                <li>每人平均用餐價位：￥15,000－￥19,999</li>
                                <li>支付方式：已線上預約並付款</li>
                                <li>參考資料：<a href="https://tabelog.com/tw/tokyo/A1304/A130401/13004274/" target="_blank">日本餐廳評論網站</a></li>
                             </ul>
                             <button class="gemini-btn food-ai-btn" data-restaurant="人形町今半 新宿髙島屋店">✨ AI 美食顧問</button>
                        </div>
                    </div>
                    <!-- MyGO!!!!! Category -->
                    <div id="category-mygo-area" class="category-tab-content hidden">
                        <div class="tabs">
                            <button data-attraction-tab="asukayama-park" class="attraction-tab-btn active">飛鳥山公園</button>
                            <button data-attraction-tab="kyu-furukawa-garden" class="attraction-tab-btn">舊古河庭園</button>
                             <button data-attraction-tab="chitose-bridge" class="attraction-tab-btn">千登世步道橋</button>
                             <button data-attraction-tab="cocofulu" class="attraction-tab-btn">ココフル</button>
                        </div>
                        <div id="asukayama-park" class="attraction-content">
                            <img src="https://images.unsplash.com/photo-1627725941490-5a331169a031?q=80&w=1200&auto=format&fit=crop" alt="飛鳥山公園" class="attraction-detail-image lightbox-trigger">
                            <h4>飛鳥山公園 🌸</h4>
                            <p>江戶時代起就是著名的賞櫻勝地，也是《MyGO!!!!!》動畫的聖地，可以尋找動畫中爽世與祥子「戰鬥」過的噴水池等景點。</p>
                        </div>
                        <div id="kyu-furukawa-garden" class="attraction-content hidden">
                            <img src="https://images.unsplash.com/photo-1551537025-a64c06252924?q=80&w=1200&auto=format&fit=crop" alt="舊古河庭園" class="attraction-detail-image lightbox-trigger">
                            <h4>舊古河庭園 🌹</h4>
                            <p>融合了日式庭園與西式洋館的獨特設計，是《MyGO!!!!!》動畫中祥子家的原型地。</p>
                        </div>
                        <div id="chitose-bridge" class="attraction-content hidden">
                            <img src="https://images.unsplash.com/photo-1532258380696-62635344395a?q=80&w=1200&auto=format&fit=crop" alt="千登世步道橋" class="attraction-detail-image lightbox-trigger">
                            <h4>千登世步道橋 🌉</h4>
                            <p>《MyGO!!!!!》動畫中，祥子邀請燈組成樂團，經典的「祥子成為人類的橋」，是粉絲必訪的朝聖地點。</p>
                        </div>
                        <div id="cocofulu" class="attraction-content hidden">
                            <img src="https://images.unsplash.com/photo-1559305419-6f481a523a6c?q=80&w=1200&auto=format&fit=crop" alt="ココフル" class="attraction-detail-image lightbox-trigger">
                            <h4>ココフル ☕</h4>
                            <p>位於飛鳥山公園附近的咖啡店或簡餐店，適合在遊覽公園後稍作休息，補充能量。</p>
                             <ul>
                                <li>推薦料理：通常提供咖啡、輕食、或簡餐。</li>
                                <li>每人平均用餐價位：￥1,000－￥1,999</li>
                                <li>支付方式：可接受信用卡、可接受電子現金（西瓜卡等）</li>
                                <li>參考資料：<a href="https://tabelog.com/tokyo/A1323/A132303/13202218/" target="_blank">日本餐廳評論網站</a></li>
                             </ul>
                            <button class="gemini-btn food-ai-btn" data-restaurant="ココフルcocofulu">✨ AI 美食顧問</button>
                        </div>
                    </div>
                    <!-- Akihabara/Jimbocho Category -->
                    <div id="category-akiba" class="category-tab-content hidden">
                         <div class="tabs">
                            <button data-attraction-tab="hotel-grand-central" class="attraction-tab-btn active">東京中央大飯店</button>
                            <button data-attraction-tab="kitchen-nankai" class="attraction-tab-btn">廚房南海 神保町店</button>
                            <button data-attraction-tab="akiba-radio-hall" class="attraction-tab-btn">秋葉原ラジオ會館</button>
                            <button data-attraction-tab="hakata-furyu" class="attraction-tab-btn">とんこつラーメン博多風龍</button>
                            <button data-attraction-tab="e-earphone" class="attraction-tab-btn">e-earphone 秋葉原店</button>
                            <button data-attraction-tab="tonkatsu-ippe" class="attraction-tab-btn">とんかつ檍のカレー屋 いっぺこっぺ</button>
                            <button data-attraction-tab="the-akiba" class="attraction-tab-btn">ギフトショップ The AkiBa</button>
                        </div>
                        <div id="hotel-grand-central" class="attraction-content">
                             <img src="https://images.unsplash.com/photo-1582719478250-c89cae4dc85b?q=80&w=1200&auto=format&fit=crop" alt="東京中央大飯店" class="attraction-detail-image lightbox-trigger">
                             <h4>東京中央大飯店 (Grand Central Hotel, Tokyo) 🏨</h4>
                             <p>位於交通樞紐，鄰近神田、秋葉原等地，是一家提供經典舒適住宿體驗的飯店，方便前往東京各個角落。</p>
                        </div>
                        <div id="kitchen-nankai" class="attraction-content hidden">
                             <img src="https://images.unsplash.com/photo-1599939887324-743d0452a233?q=80&w=1200&auto=format&fit=crop" alt="廚房南海 神保町店" class="attraction-detail-image lightbox-trigger">
                             <h4>廚房南海 神保町店 🍛</h4>
                             <p>神保町地區的傳奇洋食老店，以其份量十足、價格實惠的黑色咖哩聞名，是當地人與學生們的最愛。</p>
                             <ul>
                                 <li>推薦料理：豬排咖哩飯、奶油可樂餅。</li>
                                 <li>每人平均用餐價位：￥1,000－￥1,999</li>
                                 <li>支付方式：只接受現金</li>
                                 <li>參考資料：<a href="https://tabelog.com/tw/tokyo/A1310/A131003/13249021/" target="_blank">日本餐廳評論網站</a></li>
                             </ul>
                             <button class="gemini-btn food-ai-btn" data-restaurant="廚房南海 神保町店">✨ AI 美食顧問</button>
                        </div>
                        <div id="akiba-radio-hall" class="attraction-content hidden">
                             <img src="https://images.unsplash.com/photo-1613487957484-321c4196a39b?q=80&w=1200&auto=format&fit=crop" alt="秋葉原ラジオ會館" class="attraction-detail-image lightbox-trigger">
                             <h4>秋葉原ラジオ會館 🗼</h4>
                             <p>秋葉原的地標性建築之一，是動漫、模型、卡牌和偶像周邊商品的聚集地，動漫迷的天堂。</p>
                        </div>
                        <div id="hakata-furyu" class="attraction-content hidden">
                             <img src="https://images.unsplash.com/photo-1552611052-33e04de081de?q=80&w=1200&auto=format&fit=crop" alt="とんこつラーメン博多風龍" class="attraction-detail-image lightbox-trigger">
                             <h4>とんこつラーメン博多風龍 秋葉原総本店 🍜</h4>
                             <p>提供正宗的博多豚骨拉麵，以其濃郁的湯頭和可以免費續加兩次的細麵為特色，CP值極高。</p>
                             <ul>
                                 <li>推薦料理：豚骨拉麵，可自選麵的硬度。</li>
                                 <li>每人平均用餐價位：￥1,000－￥1,999</li>
                                 <li>支付方式：不接受信用卡、可接受電子現金（西瓜卡等）、可接受PayPay支付（QRCode）</li>
                                 <li>參考資料：<a href="https://tabelog.com/tw/tokyo/A1311/A131101/13096267/" target="_blank">日本餐廳評論網站</a></li>
                             </ul>
                             <button class="gemini-btn food-ai-btn" data-restaurant="とんこつラーメン博多風龍 秋葉原総本店">✨ AI 美食顧問</button>
                        </div>
                        <div id="e-earphone" class="attraction-content hidden">
                             <img src="https://images.unsplash.com/photo-1590658262432-722617a01353?q=80&w=1200&auto=format&fit=crop" alt="e-earphone 秋葉原店" class="attraction-detail-image lightbox-trigger">
                             <h4>e-earphone 秋葉原店 🎧</h4>
                             <p>耳機與音響發燒友的聖地，提供極為豐富的各品牌耳機、播放器試聽與選購服務。</p>
                        </div>
                        <div id="tonkatsu-ippe" class="attraction-content hidden">
                             <img src="https://images.unsplash.com/photo-1599033665338-34a8a54d6f3c?q=80&w=1200&auto=format&fit=crop" alt="とんかつ檍のカレー屋 いっぺこっぺ" class="attraction-detail-image lightbox-trigger">
                             <h4>とんかつ檍のカレー屋 いっぺこっぺ 秋葉原店 🐷</h4>
                             <p>以高品質的炸豬排和獨特的咖哩醬聞名，提供酥脆多汁的炸豬排與濃郁咖哩的完美結合。</p>
                             <ul>
                                 <li>推薦料理：招牌炸豬排咖哩飯。</li>
                                 <li>每人平均用餐價位：￥1,000－￥1,999</li>
                                 <li>支付方式：只接受日圓現金</li>
                                 <li>參考資料：<a href="https://tabelog.com/tokyo/A1311/A131101/13259701/" target="_blank">日本餐廳評論網站</a></li>
                             </ul>
                             <button class="gemini-btn food-ai-btn" data-restaurant="とんかつ檍のカレー屋 いっぺこっぺ 秋葉原店">✨ AI 美食顧問</button>
                        </div>
                        <div id="the-akiba" class="attraction-content hidden">
                             <img src="https://images.unsplash.com/photo-1571848504955-a23b3a168936?q=80&w=1200&auto=format&fit=crop" alt="ギフトショップ The AkiBa" class="attraction-detail-image lightbox-trigger">
                             <h4>ギフトショップ The AkiBa 🎁</h4>
                             <p>位於秋葉原ラジオ會館一樓的伴手禮店，販售各種與秋葉原、動漫文化相關的特色商品與點心。</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="transportation">
            <div class="section-header reveal">
                <h2>交通資訊</h2>
                <p>各主要景點與餐廳之間的移動方式與交通費用概覽。</p>
            </div>
            <img src="https://images.unsplash.com/photo-1533139143976-357121153202?q=80&w=1200&auto=format&fit=crop" alt="Transportation Map Image" class="section-image reveal lightbox-trigger">
            <div class="card reveal">
                <div class="tabs">
                    <button data-transportation-tab="nrt-to-mustard" class="transportation-tab-btn active">機場 → 下北澤飯店</button>
                    <button data-transportation-tab="mustard-to-grand" class="transportation-tab-btn">下北澤 → 東京中央</button>
                    <button data-transportation-tab="grand-to-mygo" class="transportation-tab-btn">飯店 → MyGO聖地</button>
                    <button data-transportation-tab="grand-to-nrt" class="transportation-tab-btn">飯店 → 機場</button>
                </div>
                <div class="prose-custom">
                    <div id="nrt-to-mustard" class="transportation-content">
                        <h4>成田機場 (NRT) → 下北澤芥末飯店 ✈️➡️🏨</h4>
                        <ul>
                            <li>方式: 成田特快 (N'EX) + 京王井之頭線</li>
                            <li>說明: 搭乘N'EX至澀谷站，再轉乘京王井之頭線至下北澤站。</li>
                            <li>預估費用 (每人): 約 ¥3,250</li>
                        </ul>
                    </div>
                    <div id="mustard-to-grand" class="transportation-content hidden">
                        <h4>下北澤芥末飯店 → 東京中央大飯店 🏨➡️🏨</h4>
                        <ul>
                            <li>方式: 京王井之頭線 + JR山手線/中央線</li>
                            <li>說明: 從下北澤搭至澀谷或新宿，再轉乘JR線至神田站。</li>
                            <li>預估費用 (每人): 約 ¥350</li>
                        </ul>
                    </div>
                    <div id="grand-to-mygo" class="transportation-content hidden">
                        <h4>東京中央大飯店 → MyGO聖地 (飛鳥山/舊古河庭園) 🏨➡️🌸</h4>
                        <ul>
                            <li>方式: JR山手線/京濱東北線</li>
                            <li>說明: 從神田站搭乘JR線至王子站或上中里站。</li>
                            <li>預估費用 (每人): 約 ¥170</li>
                        </ul>
                    </div>
                    <div id="grand-to-nrt" class="transportation-content hidden">
                        <h4>東京中央大飯店 → 成田機場 (NRT) 🏨➡️✈️</h4>
                        <ul>
                            <li>方式: JR山手線 + 京成Skyliner</li>
                            <li>說明: 從神田站搭JR至日暮里或上野，再轉乘Skyliner。</li>
                            <li>預估費用 (每人): 約 ¥2,720</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <section id="budget">
            <div class="section-header reveal">
                <h2>預算分析</h2>
                <p>深入了解各項開銷的細節，有效控管您的旅行預算。</p>
            </div>
            <img src="https://images.unsplash.com/photo-1565932887479-131ed3e1554a?q=80&w=1200&auto=format&fit=crop" alt="Travel Budget Image" class="section-image reveal lightbox-trigger">
            <div class="grid grid-cols-1 lg-grid-cols-2">
                <div class="card reveal">
                    <h3 class="text-center">各項費用比較</h3>
                    <div class="chart-container h-96">
                        <canvas id="expenseBarChart"></canvas>
                    </div>
                </div>
                <div class="card reveal">
                     <h3 class="text-center">費用明細表</h3>
                     <div>
                        <table>
                            <thead><tr><th>費用類別</th><th class="text-right">費用 (JPY)</th><th class="text-right">費用 (NTD)</th></tr></thead>
                            <tbody>
                            </tbody>
                            <tfoot>
                            </tfoot>
                        </table>
                        <p class="text-xs text-right mt-2">*日圓與台幣換算匯率以0.21估算，實際費用可能變動。</p>
                     </div>
                </div>
            </div>
        </section>

        <section id="shopping-list">
            <div class="section-header reveal">
                <h2>購物 & 伴手禮清單</h2>
                <p>確保不漏掉任何想買的物品或送給親友的伴手禮！</p>
            </div>
            <img src="https://images.unsplash.com/photo-1563013544-824ae1b704d3?q=80&w=1200&auto=format&fit=crop" alt="Shopping List Image" class="section-image reveal lightbox-trigger">
            <div class="card reveal interactive-checklist" id="shopping-checklist">
                <h3>購物清單 🛍️</h3>
                <ul>
                    <li><input type="checkbox" id="shop_toiletries"><label for="shop_toiletries">盥洗用品：牙刷、牙膏、洗面乳 🧴</label></li>
                    <li><input type="checkbox" id="shop_3c"><label for="shop_3c">3C用品：藍芽耳機、手機殼與行動電源</label></li>
                    <li><input type="checkbox" id="shop_medical"><label for="shop_medical">醫療用品：人工淚液（需確認是否可帶回國）👁️‍🗨️</label></li>
                    <li><input type="checkbox" id="shop_clothes"><label for="shop_clothes">服飾：可在UN、GQ等便宜地方購買 👕</label></li>
                </ul>
                <h3 style="margin-top: 2rem;">伴手禮 🎁</h3>
                <ul>
                    <li><input type="checkbox" id="souvenir_top"><label for="souvenir_top">女性上衣（UN、GQ）👚</label></li>
                    <li><input type="checkbox" id="souvenir_apple"><label for="souvenir_apple">全家蘋果乾兩包 🍎</label></li>
                    <li><input type="checkbox" id="souvenir_akiba"><label for="souvenir_akiba">秋葉原百貨商店的伴手禮（家人、同事）🛍️</label></li>
                </ul>
            </div>
        </section>
        
        <section id="checklist">
            <div class="section-header reveal">
                <h2>行前準備清單</h2>
                <p>確保萬事俱備，讓您的旅程順暢無憂。</p>
            </div>
            <img src="https://images.unsplash.com/photo-1522202615453-3c42981a881e?q=80&w=1200&auto=format&fit=crop" alt="Travel Checklist Image" class="section-image reveal lightbox-trigger">
            <div class="card reveal interactive-checklist" id="pre-trip-checklist">
                <h3>行前準備</h3>
                <ul>
                    <li><input type="checkbox" id="pre_covid_vaccine"><label for="pre_covid_vaccine">新冠疫苗施打 💉</label></li>
                    <li><input type="checkbox" id="pre_flu_vaccine"><label for="pre_flu_vaccine">流感疫苗施打 🤧</label></li>
                    <li><input type="checkbox" id="pre_tigerair_email"><label for="pre_tigerair_email">虎航行程確認單（在Email裡）📧</label></li>
                    <li><input type="checkbox" id="pre_visit_japan_web"><label for="pre_visit_japan_web">Visit Japan Web入境手續 ✅</label></li>
                    <li><input type="checkbox" id="pre_travel_insurance"><label for="pre_travel_insurance">旅平險 🛡️</label></li>
                    <li><input type="checkbox" id="pre_credit_card"><label for="pre_credit_card">申辦日本旅遊信用卡 💳</label></li>
                    <li><input type="checkbox" id="pre_japan_sim"><label for="pre_japan_sim">日本網卡 📶</label></li>
                    <li><input type="checkbox" id="pre_common_meds"><label for="pre_common_meds">常用藥物購買（防止胃脹氣、胃酸過多；消炎止痛藥、透氣膠帶、ＯＫ蹦）🩹</label></li>
                    <li><input type="checkbox" id="pre_rest_order"><label for="pre_rest_order">餐廳事前預約🫕</label></li>
                </ul>
                <h3 style="margin-top: 2rem;">旅遊必備品</h3>
                <ul>
                    <li><input type="checkbox" id="item_passport"><label for="item_passport">護照 🛂</label></li>
                    <li><input type="checkbox" id="item_phone"><label for="item_phone">手機 📱</label></li>
                    <li><input type="checkbox" id="item_charger"><label for="item_charger">充電器 🔌</label></li>
                    <li><input type="checkbox" id="item_power_bank"><label for="item_power_bank">行動電源 🔋</label></li>
                    <li><input type="checkbox" id="item_universal_adapter"><label for="item_universal_adapter">萬國充 🌍</label></li>
                    <li><input type="checkbox" id="item_wallet"><label for="item_wallet">錢包（信用卡）💰</label></li>
                    <li><input type="checkbox" id="item_yen"><label for="item_yen">日圓（ATM領取或兌換）💴</label></li>
                    <li><input type="checkbox" id="item_clothes"><label for="item_clothes">換洗衣物（三天份）👕👖</label></li>
                    <li><input type="checkbox" id="item_toiletries"><label for="item_toiletries">盥洗用品（牙刷、牙膏、毛巾）🧴</label></li>
                    <li><input type="checkbox" id="item_motion_sickness_med"><label for="item_motion_sickness_med">暈車藥吃了沒 💊</label></li>
                    <li><input type="checkbox" id="item_room_key"><label for="item_room_key">房門鑰匙 🔑</label></li>
                    <li><input type="checkbox" id="item_water_bottle"><label for="item_water_bottle">水瓶（一點點水）💧</label></li>
                    <li><input type="checkbox" id="item_waist_bag"><label for="item_waist_bag">腰包 👝</label></li>
                    <li><input type="checkbox" id="item_hand_luggage"><label for="item_hand_luggage">手提行李包 💼</label></li>
                    <li><input type="checkbox" id="item_twd_cash"><label for="item_twd_cash">台幣現鈔（5000以內以備不時之需）💵</label></li>
                </ul>
            </div>
        </section>

    </main>

    <footer class="text-center py-8 mt-12" style="background-color: var(--bg-light); border-top: 1px solid var(--border-color);">
        <p class="text-sm" style="color: var(--text-muted);">此互動儀表板根據您提供的旅遊報告生成。</p>
    </footer>

    <div id="lightbox">
        <span class="close">&times;</span>
        <img id="lightbox-img" src="">
    </div>

    <div id="gemini-modal">
        <div class="gemini-modal-content">
            <button class="gemini-modal-close">&times;</button>
            <h3 id="gemini-modal-title"></h3>
            <div id="gemini-modal-body">
                <div class="loader"></div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // Recalculate food cost for two people
        const mealCostsPerPerson = {
            '路地裏咖哩 侍 下北澤店': 2255,
            '白髭泡芙工房': 999,
            'Village Vanguard Diner Shimokitazawa': 2999,
            'えくぶり': 1999, // Assuming similar to Cocofulu
            '吟味焼肉 じゃんか 道玄坂': 1999,
            '人形町今半 新宿髙島屋店': 19999,
            'ココフル': 1999,
            '廚房南海 神保町店': 1999,
            'とんこつラーメン博多風龍 秋葉原総本店': 1999,
            'とんかつ檍のカレー屋 いっぺこっぺ 秋葉原店': 1999,
            '超商晚餐': 1000, // Estimate
            '超商早餐': 800, // Estimate
            '隨意午餐': 1500, // Estimate
            '機場晚餐': 2000 // Estimate
        };

        const itineraryMeals = [
            mealCostsPerPerson['超商晚餐'], // Day 1
            mealCostsPerPerson['超商早餐'], mealCostsPerPerson['路地裏咖哩 侍 下北澤店'], mealCostsPerPerson['白髭泡芙工房'], mealCostsPerPerson['Village Vanguard Diner Shimokitazawa'], // Day 2
            mealCostsPerPerson['えくぶり'], mealCostsPerPerson['吟味焼肉 じゃんか 道玄坂'], mealCostsPerPerson['人形町今半 新宿髙島屋店'], // Day 3
            0, mealCostsPerPerson['ココフル'], mealCostsPerPerson['廚房南海 神保町店'], // Day 4 (Breakfast from previous day)
            mealCostsPerPerson['超商早餐'], mealCostsPerPerson['とんこつラーメン博多風龍 秋葉原総本店'], mealCostsPerPerson['とんかつ檍のカレー屋 いっぺこっぺ 秋葉原店'], // Day 5
            0, mealCostsPerPerson['隨意午餐'], mealCostsPerPerson['機場晚餐'] // Day 6 (Breakfast from previous day)
        ];
        
        const totalFoodCostPerPerson = itineraryMeals.reduce((sum, cost) => sum + cost, 0);
        const totalFoodCostTwoPeople = totalFoodCostPerPerson * 2;


        const tripData = {
            costsJPY: {
                accommodation: 79381,
                transportation: 9000,
                food: totalFoodCostTwoPeople, // Updated food cost
                shopping: 125000,
                tickets: 150
            },
            costsNTD: {
                flights: 33076
            },
            exchangeRate: 0.21
        };
        
        const calculateTotal = () => {
            const totalJPY = Object.values(tripData.costsJPY).reduce((sum, cost) => sum + cost, 0);
            const jpyInNtd = totalJPY * tripData.exchangeRate;
            const totalNTD = jpyInNtd + tripData.costsNTD.flights;
            
            document.getElementById('totalCost').textContent = `NTD ${Math.round(totalNTD).toLocaleString()}`;

            const budgetTableBody = document.querySelector('#budget tbody');
            const budgetTableFoot = document.querySelector('#budget tfoot');
            budgetTableBody.innerHTML = `
                <tr><td class="font-medium">機票</td><td class="text-right">-</td><td class="text-right">${tripData.costsNTD.flights.toLocaleString()}</td></tr>
                <tr><td class="font-medium">住宿</td><td class="text-right">${tripData.costsJPY.accommodation.toLocaleString()}</td><td class="text-right">${Math.round(tripData.costsJPY.accommodation * tripData.exchangeRate).toLocaleString()}</td></tr>
                <tr><td class="font-medium">交通</td><td class="text-right">${tripData.costsJPY.transportation.toLocaleString()}</td><td class="text-right">${Math.round(tripData.costsJPY.transportation * tripData.exchangeRate).toLocaleString()}</td></tr>
                <tr><td class="font-medium">餐飲</td><td class="text-right">${tripData.costsJPY.food.toLocaleString()}</td><td class="text-right">${Math.round(tripData.costsJPY.food * tripData.exchangeRate).toLocaleString()}</td></tr>
                <tr><td class="font-medium">購物與雜項</td><td class="text-right">${tripData.costsJPY.shopping.toLocaleString()}</td><td class="text-right">${Math.round(tripData.costsJPY.shopping * tripData.exchangeRate).toLocaleString()}</td></tr>
                <tr><td class="font-medium">景點門票</td><td class="text-right">${tripData.costsJPY.tickets.toLocaleString()}</td><td class="text-right">${Math.round(tripData.costsJPY.tickets * tripData.exchangeRate).toLocaleString()}</td></tr>
            `;
            budgetTableFoot.innerHTML = `<tr><td>總計</td><td class="text-right">¥${totalJPY.toLocaleString()}</td><td class="text-right">NTD ${Math.round(totalNTD).toLocaleString()}</td></tr>`;

            return { totalJPY, totalNTD };
        };


        const revealElements = document.querySelectorAll('.reveal');
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('active');
                }
            });
        }, { threshold: 0.1 });
        revealElements.forEach(el => observer.observe(el));

        const setupNavigation = () => {
            const navLinks = document.querySelectorAll('.nav-links a');
            const sections = document.querySelectorAll('main section');
            const mobileNav = document.getElementById('mobile-nav');
            
            window.addEventListener('scroll', () => {
                let current = '';
                sections.forEach(section => {
                    const sectionTop = section.offsetTop;
                    if (pageYOffset >= sectionTop - 100) { current = section.getAttribute('id'); }
                });

                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if(link.getAttribute('href') === `#${current}`) { link.classList.add('active'); }
                });
                
                if (mobileNav.value !== `#${current}`) { mobileNav.value = `#${current}`; }
            });
        };

        const setupCharts = () => {
            Chart.defaults.color = 'rgba(234, 234, 234, 0.8)';
            Chart.defaults.font.family = "'Noto Sans TC', sans-serif";
            const commonTooltip = {
                backgroundColor: 'rgba(30, 30, 30, 0.9)', titleFont: { size: 14, weight: 'bold' },
                bodyFont: { size: 12 }, padding: 10, cornerRadius: 6,
                borderColor: 'rgba(247, 183, 51, 0.5)', borderWidth: 1
            };

            const costLabels = ['機票', '住宿', '交通', '餐飲', '購物與雜項', '景點門票'];
            const costValuesNTD = [
                tripData.costsNTD.flights,
                tripData.costsJPY.accommodation * tripData.exchangeRate,
                tripData.costsJPY.transportation * tripData.exchangeRate,
                tripData.costsJPY.food * tripData.exchangeRate,
                tripData.costsJPY.shopping * tripData.exchangeRate,
                tripData.costsJPY.tickets * tripData.exchangeRate
            ];

            const donutCtx = document.getElementById('budgetDonutChart')?.getContext('2d');
            if (donutCtx) {
                new Chart(donutCtx, {
                    type: 'doughnut',
                    data: {
                        labels: costLabels,
                        datasets: [{
                            data: costValuesNTD,
                            backgroundColor: ['#29D8E4', '#F7B733', '#8E44AD', '#3498DB', '#E74C3C', '#2ECC71'],
                            borderColor: '#1E1E1E', borderWidth: 4,
                        }]
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        plugins: { legend: { position: 'bottom', labels: { padding: 20 } }, tooltip: commonTooltip }
                    }
                });
            }

            const barCtx = document.getElementById('expenseBarChart')?.getContext('2d');
            if(barCtx) {
                const barLabels = ['住宿', '交通', '餐飲', '購物', '景點'];
                const barValuesJPY = [ 
                    tripData.costsJPY.accommodation,
                    tripData.costsJPY.transportation,
                    tripData.costsJPY.food,
                    tripData.costsJPY.shopping,
                    tripData.costsJPY.tickets
                ];
                new Chart(barCtx, {
                    type: 'bar',
                    data: { labels: barLabels, datasets: [{
                        label: '預估花費 (JPY)', data: barValuesJPY,
                        backgroundColor: 'rgba(41, 216, 228, 0.6)', borderColor: 'rgba(41, 216, 228, 1)', borderWidth: 1
                    }]},
                    options: {
                        indexAxis: 'y', responsive: true, maintainAspectRatio: false,
                        scales: { x: { grid: { color: 'rgba(255,255,255,0.1)' } }, y: { grid: { display: false } } },
                        plugins: { legend: { display: false }, tooltip: { ...commonTooltip, callbacks: {
                            label: function(context) {
                                const valueJPY = context.raw;
                                const valueNTD = Math.round(valueJPY * tripData.exchangeRate);
                                return `日圓: ¥${valueJPY.toLocaleString()} | 新台幣: NT$${valueNTD.toLocaleString()}`;
                            }
                        }}}
                    }
                });
            }
        };
        
        const setupTabs = (containerSelector, btnSelector, contentSelector) => {
            const container = document.querySelector(containerSelector);
            if (!container) return;
            container.addEventListener('click', e => {
                if (!e.target.matches(btnSelector)) return;
                const button = e.target;
                const tabButtons = container.querySelectorAll(btnSelector);
                const tabContents = container.querySelectorAll(contentSelector);
                const tabId = button.dataset.tab || button.dataset.attractionTab || button.dataset.transportationTab;
                tabButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                tabContents.forEach(content => content.classList.toggle('hidden', content.id !== tabId));
            });
        };

        const setupNestedTabs = () => {
            const attractionsSection = document.getElementById('attractions');
            if (!attractionsSection) return;
            const categoryButtons = attractionsSection.querySelectorAll('.category-tab-btn');
            const categoryContents = attractionsSection.querySelectorAll('.category-tab-content');

            categoryButtons.forEach(catButton => {
                catButton.addEventListener('click', () => {
                    categoryButtons.forEach(btn => btn.classList.remove('active'));
                    catButton.classList.add('active');
                    const categoryId = catButton.dataset.categoryTab;
                    categoryContents.forEach(content => content.classList.toggle('hidden', content.id !== categoryId));
                    const activeCategory = document.getElementById(categoryId);
                    if(activeCategory) {
                        const firstAttractionBtn = activeCategory.querySelector('.attraction-tab-btn');
                        if(firstAttractionBtn) firstAttractionBtn.click();
                    }
                });
            });

            attractionsSection.querySelectorAll('.category-tab-content').forEach(category => {
                const attractionButtons = category.querySelectorAll('.attraction-tab-btn');
                const attractionContents = category.querySelectorAll('.attraction-content');
                attractionButtons.forEach(attBtn => {
                    attBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        attractionButtons.forEach(btn => btn.classList.remove('active'));
                        attBtn.classList.add('active');
                        const attractionId = attBtn.dataset.attractionTab;
                        attractionContents.forEach(content => content.classList.toggle('hidden', content.id !== attractionId));
                    });
                });
            });
        };

        const setupChecklists = () => {
            document.querySelectorAll('.interactive-checklist').forEach(list => {
                const storageKey = list.id + '-state';
                const savedState = JSON.parse(localStorage.getItem(storageKey)) || {};
                list.querySelectorAll('input[type="checkbox"]').forEach(input => {
                    if (savedState[input.id]) { input.checked = true; }
                });
                list.addEventListener('change', e => {
                    if (e.target.type === 'checkbox') {
                        const currentState = JSON.parse(localStorage.getItem(storageKey)) || {};
                        currentState[e.target.id] = e.target.checked;
                        localStorage.setItem(storageKey, JSON.stringify(currentState));
                    }
                });
            });
        };

        const setupLightbox = () => {
            const lightbox = document.getElementById('lightbox');
            if(!lightbox) return;
            const lightboxImg = document.getElementById('lightbox-img');
            const closeBtn = lightbox.querySelector('.close');
            const closeLightbox = () => lightbox.classList.remove('active');
            document.body.addEventListener('click', e => {
                if (e.target.matches('.lightbox-trigger')) {
                    lightboxImg.src = e.target.src;
                    lightbox.classList.add('active');
                }
            });
            closeBtn.addEventListener('click', closeLightbox);
            lightbox.addEventListener('click', (e) => { if(e.target === lightbox) closeLightbox(); });
        };

        const highlightCurrentDay = () => {
            const tripStartDate = new Date('2025-08-18T00:00:00');
            const today = new Date();
            const diffTime = today - tripStartDate;
            if (diffTime < 0) return; 
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24)) + 1;
            if (diffDays >= 1 && diffDays <= 6) {
                const currentDayTab = document.querySelector(`.tab-btn[data-tab="day${diffDays}"]`);
                if (currentDayTab) { currentDayTab.click(); }
            }
        };

        const geminiModal = document.getElementById('gemini-modal');
        const geminiModalTitle = document.getElementById('gemini-modal-title');
        const geminiModalBody = document.getElementById('gemini-modal-body');
        const loadingIndicator = '<div class="loader"></div>';

        async function callGeminiAPI(prompt) {
            geminiModalBody.innerHTML = loadingIndicator;
            geminiModal.classList.add('active');
            
            const apiKey = ""; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
            const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) { throw new Error(`API 錯誤: ${response.status}`); }
                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 && result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    geminiModalBody.innerHTML = text.replace(/\n/g, '<br>');
                } else {
                    geminiModalBody.textContent = '抱歉，無法從 AI 取得回應。請稍後再試。';
                }
            } catch (error) {
                console.error('Gemini API 呼叫失敗:', error);
                geminiModalBody.textContent = `發生錯誤：${error.message}，請檢查主控台以獲取詳細資訊。`;
            }
        }
        
        document.querySelectorAll('.itinerary-ai-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const contentContainer = e.target.closest('.tab-content');
                const title = contentContainer.querySelector('h3').textContent;
                const items = Array.from(contentContainer.querySelectorAll('li')).map(li => li.textContent.trim()).join('\n');
                const prompt = `我是一位正在規劃日本東京自由行的旅客，以下是我其中一天的行程計畫：\n\n標題：${title}\n行程細節：\n${items}\n\n請以一個專業日本旅遊達人的口吻，用繁體中文，為我提供 3-4 個具體的優化建議。建議可以包含：\n- 更順暢的交通路線安排\n- 行程中可以順道加入的私房景點或特色小店\n- 值得注意的省錢小技巧或文化禮儀提醒\n- 推薦的拍照打卡點\n請用條列式的方式呈現，讓建議一目了然。`;
                
                geminiModalTitle.textContent = `AI 行程優化建議 - ${title.split(':')[0]}`;
                callGeminiAPI(prompt);
            });
        });

        document.querySelectorAll('.food-ai-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const restaurantName = e.target.dataset.restaurant;
                const prompt = `我即將要去位於東京的餐廳「${restaurantName}」。請扮演一位活潑的美食部落客，用生動有趣且吸引人的語氣，以繁體中文為我介紹這家餐廳。\n\n請包含以下幾點：\n1.  **必點招牌菜**：推薦 2-3 道絕對不能錯過的菜色，並形容它們的口感與特色。\n2.  **餐廳特色或故事**：分享這家店的獨特之處，例如裝潢風格、創辦歷史或有趣的用餐體驗。\n3.  **推薦搭配**：建議適合搭配主餐的飲品或小菜。\n\n請讓你的回覆像一篇精彩的食記短文，讓我看完就迫不及待想去品嚐！`;

                geminiModalTitle.textContent = `AI 美食顧問 - ${restaurantName}`;
                callGeminiAPI(prompt);
            });
        });

        geminiModal.querySelector('.gemini-modal-close').addEventListener('click', () => geminiModal.classList.remove('active'));
        geminiModal.addEventListener('click', (e) => { if(e.target === geminiModal) geminiModal.classList.remove('active'); });
        
        // --- 🚀 執行所有初始化 ---
        calculateTotal();
        setupNavigation();
        setupCharts();
        setupTabs('#itinerary', '.tab-btn', '.tab-content');
        setupTabs('#transportation', '.transportation-tab-btn', '.transportation-content');
        setupNestedTabs();
        setupChecklists();
        setupLightbox();
        highlightCurrentDay();
    });
    </script>
</body>
</html>
